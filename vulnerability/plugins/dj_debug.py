from vulnerability.vulnerability import VulnerabilityLevel, VulnerabilityType, Vulnerability
from analyzer.plugin_loader import call_with


djdebug = VulnerabilityType("Debug mode turned on. Dangerous to run in production as the app may\n    "
                            "output internal details, which can be used by attackers.\n    "
                            "More information: https://docs.djangoproject.com/en/3.1/ref/settings/#debug",
                            "Set DEBUG to False in settings.py", VulnerabilityLevel.high)


@call_with("Assign")
def find_djdebug(self, node):
    if self.file.endswith("settings.py"):
        for target in node.targets:
            if target.id == "DEBUG":
                if node.value.value == True:
                    self.vulnerabilities.add(Vulnerability(file=self.file, lineno=node.lineno,
                                                              vuln_type=djdebug))
